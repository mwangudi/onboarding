@model OnBoarding.ViewModels.AdminApproveViewModel
<script src="@Url.Content("~/Assets/fwizard/form-wizard.js")"></script>
<div class="form-row form-wizard">
    <!-- Form Wizard -->
    <form class="mt-0" role="form" id="ApplicationForm" action="" method="POST" accept-charset="utf-8">
        <!-- Form Step 1 -->
        <fieldset>
            <h6>Company Details</h6><hr />
            <div class="form-group">
                <div class="table-responsive">
					<table class="table table-bordered">
						<tr class="success">
							<th>Business Account :</th>
							<td></td>
							<td style="text-align: right;"><i class="fa fa-archive"></i></td>
						</tr>
						<tr>
							<th>Company Account Number:</th>
							<td id="AccountNumber" name="AccountNumber" colspan="2">@ViewBag.ApplicationInfo.AccountNumber</td>
						</tr>
						<tr class="success">
							<th>Company Details:</th>
							<td></td>
							<td style="text-align: right;"><i class="fa fa fa-building fa-x"></i></td>
						</tr>
						<tr>
							<th>Company Name:</th>
							<td id="CompanyName" name="CompanyName" colspan="2">@ViewBag.CompanyInfo.CompanyName</td>
						</tr>
						<tr>
							<th>Company Registration Number:</th>
							<td id="ConfirmRegistration" name="ConfirmRegistration" colspan="2">@ViewBag.CompanyInfo.CompanyRegNumber</td>
						</tr>
						<tr class="success">
							<th>Principal Place of Business:</th>
							<td></td>
							<td style="text-align: right;"><i class="fa fa fa-location-arrow fa-x"></i></td>
						</tr>
						<tr>
							<th>Company Building:</th>
							<td id="Building" name="Building" colspan="2">@ViewBag.CompanyInfo.CompanyBuilding</td>
						</tr>
						<tr>
							<th>Street:</th>
							<td id="Street" name="Street" colspan="2">@ViewBag.CompanyInfo.CompanyStreet</td>
						</tr>
						<tr>
							<th>Company Town/City:</th>
							<td id="CompanyTownCity" name="CompanyTownCity" colspan="2">@ViewBag.CompanyInfo.CompanyTownCity</td>
						</tr>
						<tr>
							<th>Postal Address:</th>
							<td id="PostalAddress" name="PostalAddress" colspan="2">@ViewBag.CompanyInfo.PostalAddress - @ViewBag.CompanyInfo.PostalCode - @ViewBag.CompanyInfo.TownCity</td>
						</tr>
						<tr>
							<th>Business Email Address:</th>
							<td id="BusinessEmailAddress" name="BusinessEmailAddress" colspan="2">@ViewBag.CompanyInfo.BusinessEmailAddress</td>
						</tr>
						<tr>
							<th>Attention where notices will be sent:</th>
							<td id="AttentionTo" name="AttentionTo" colspan="2">@ViewBag.CompanyInfo.AttentionTo</td>
						</tr>
						<tr class="success">
							<th>Company Settlement Accounts:</th>
							<td></td>
							<td style="text-align: right;"><i class="fa fa fa-money fa-x"></i></td>
						</tr>
						<tr>
							<th>Settlement Accounts:</th>
							<td id="SettlementAccounts" name="SettlementAccounts" colspan="2">
								@if (ViewBag.SettlementAccounts.Count != 0)
								{
									<table class="custom-table">
										<th> Currency</th>
										<th> Account Number</th>
										@foreach (var item in ViewBag.SettlementAccounts)
										{
											<tbody>
											<td>@item.CurrencyName</td>
											<td>@item.AccountNumber</td>
											</tbody>
										}
									</table>
								}
								else
								{
									<table class="custom-table">No Settlement Accounts</table>
								}
							</td>
						</tr>
						<tr class="success">
							<th>Signatories Details:</th>
							<td></td>
							<td style="text-align: right;"><i class="fa fa fa-users fa-x"></i></td>
						</tr>
						<tr>
							<th>Signatories:</th>
							<td id="Signatories" name="Signatories" colspan="2">
								<table class="custom-table">
									<th> Full Names</th>
									<th> Designation </th>
									<th> Email </th>
									<th> Phone </th>
									<th> Signature </th>
									@foreach (var item in ViewBag.ClientSignatory)
									{
										<tbody>
										<td>@(item.Surname + " " + item.OtherNames)</td>
										<td>@item.Designation</td>
										<td>@item.EmailAddress</td>
										<td>@item.PhoneNumber</td>
										<td>
											@if (item.Signature == null || item.Signature == "")
											{
												<img width="100" height="80" src="~/Content/images/signatures/no-signature-17.jpg" />
											}
											else
											{
												<img width="100" height="80" src="~/Content/images/signatures/@item.Signature" />
											}
										</td>
										</tbody>
									}
								</table>
							</td>
						</tr>
						<tr class="success">
							<th>Authorized Representatives:</th>
							<td></td>
							<td style="text-align: right;"><i class="fa fa fa-users fa-x"></i></td>
						</tr>
						<tr>
							<th>Authorized Representatives:</th>
							<td id="Representatives" name="Representatives" colspan="2">
								<table class="custom-table">
									<th> Full Names</th>
									<th> Email </th>
									<th> Phone </th>
									<th> Trading Limit </th>
									<th> EMarket SignUp </th>
									<th> Signature </th>
									@foreach (var item in ViewBag.DesignatedUser)
									{
										<tbody>
										<td>@(item.Surname + " " + item.Othernames)</td>
										<td>@item.Email</td>
										<td>@item.Mobile</td>
										<td>@item.TradingLimit</td>
										<td>@(item.EMarketSignUp ? "Yes" : "No")</td>
										<td>
											@if (item.Signature == null || item.Signature == "")
											{
												<img width="100" height="80" src="~/Content/images/signatures/no-signature-17.jpg" />
											}
											else
											{
												<img width="100" height="80" src="~/Content/images/signatures/@item.Signature" />
											}
										</td>
										</tbody>
									}
								</table>
							</td>
						</tr>
						<tr class="success">
							<th>Internal Approvals:</th>
							<td></td>
							<td style="text-align: right;"><i class="fa fa fa-users fa-x"></i></td>
						</tr>
						<tr>
							<th>Operations Manager Approval:</th>
							<td id="OpsApproved" name="OpsApproved" colspan="2">
								<table class="custom-table">
									<th>Full Names</th>
									<th>Email</th>
									<th>Phone Extension</th>
									<th>Date Approved</th>
									<th>Comments</th>
									<tbody>
										<td>@ViewData["OPSNames"]</td>
										<td>@ViewData["OPSEmail"]</td>
										<td>@ViewData["OPSPhone"]</td>
										<td>@ViewData["OPSDateApproved"]</td>
										<td>@ViewData["PoaComments"]</td>
									</tbody>
								</table>
							</td>
						</tr>
					</table>
                </div>
                <div class="form-wizard-buttons">
                    <div class="col-md-6">
                        <div class="input-group accept-terms">
                            <input type="hidden" id="ApplicationId" name="ApplicationId" value="@ViewData["ApplicationId"]" class="form-control">
                            <input type="hidden" id="CompanyEmail" name="CompanyEmail" value="@ViewData["CompanyEmail"]" class="form-control">
                            <input type="hidden" id="POACanApprove" name="POACanApprove" value="@ViewData["POACanApprove"]" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="row hide-this">
                    <div class="col-12 col-md-12">
                        <h5>Provide notes upon approval or decline (if any) </h5>
                        <div class="form-group">
                            <textarea cols="12" rows="4" placeholder="Approval Notes ..." id="Comments" name="Comments" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
                <div class="row hide-this">
                    <div class="col-md-12">
                        <div class="form-wizard-buttons">
                            <button type="submit" class="btn btn-danger btnDecline"><i class="fa fa-trash"></i> Decline </button>
                            <button type="submit" class="btn btn-submit btnApprove"><i class="fa fa-check-circle"></i> Approve </button>
                        </div>
                    </div>
                </div>
            </div><br />
        </fieldset>
        <!-- End Form Step 2 -->
    </form>
    <!-- End Form Wizard -->
    <!--Processing Submission -->
    <div class="col-lg-12 d_none" id="Loading_Div">
        <center class="r_corners m_top_20">
            <h4 class="m_top_20 m_bottom_20">Please wait... Processing Your Submission</h4>
            <img src="~/Content/images/loading-bar.gif" class="img-thumbnail m_bottom_20" alt="Loading" style="max-width:160px;">
        </center>
    </div>
    <!--End Submission Processing -->
</div>
<script type="text/javascript">
    jQuery().ready(function () {
        var v = jQuery("#ApplicationForm").validate({
            rules: {
                Comments: {
                    minlength: 4,
                    maxlength: 200
                }
            },
            errorElement: "span",
            errorClass: "help-inline-error",
        });
    });

    $(document).ready(function () {
        //Close modal
        $('#closemodal').on('click', function () {
            $('#LoadUpModal').modal('hide');
        })
        //Hide show approve buttons
        if ($('#POACanApprove').val() == 0) {
            $('.hide-this').addClass('d_none');
        }
        else {
            $('.hide-this').removeClass('d_none');
        }

        //Submit Form (Approve Action)
        $('.btnApprove').on('click', function (e) {
            e.preventDefault();
            if ($('#ApplicationForm').valid()) {
                $("#Loading_Div").show('fast');
                $('#ApplicationForm').hide("fast");
                var formData = new FormData($("#ApplicationForm")[0]);
                $.ajax({
                    url: "/Poa/ApproveApplication",
                    type: 'POST',
                    data: formData,
                    async: true,
                    success: function () {
                        window.setTimeout(close, 500);
                        function close() {
                            $('#ApplicationForm')[0].reset();
                            $("#Loading_Div").hide('fast');
                            $('#Success_Div').show("fast");
                            window.location.reload();
                        }
                    },
                    cache: false,
                    contentType: false,
                    processData: false
                });
            }
        });

        //Submit Form (Decline Action)
        $('.btnDecline').on('click', function (e) {
            e.preventDefault();
            if ($('#ApplicationForm').valid()) {
                $("#Loading_Div").show('fast');
                $('#ApplicationForm').hide("fast");
                var formData = new FormData($("#ApplicationForm")[0]);
                $.ajax({
                    url: "/Poa/DeclineApplication",
                    type: 'POST',
                    data: formData,
                    async: true,
                    success: function () {
                        window.setTimeout(close, 500);
                        function close() {
                            $('#ApplicationForm')[0].reset();
                            $("#Loading_Div").hide('fast');
                            $('#Success_Div').show("fast");
                            window.location.reload();
                        }
                    },
                    cache: false,
                    contentType: false,
                    processData: false
                });
            }
        });
    });
</script>
