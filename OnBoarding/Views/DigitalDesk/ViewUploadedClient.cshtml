@model OnBoarding.ViewModels.UploadedClientViewModel
<div class="row">
	<div class="col-12">
		<div class="row" id="ViewAllUploads">
			<div class="col-lg-12 col-md-12 col-12">
				<div id="UploadsTableContainer"></div>
			</div>
			<script>
				$(document).ready(function () {
					var fileName = '@ViewData["FileName"]';
					$('#UploadsTableContainer').jtable({
						title: '<i class="fa fa-list"></i> Uploaded Clients <div class="jTableTitleDiv float-right"><button id="DeclineSelected" class="btn btn-outline-danger w_full" type="button" style="font-size:11px;line-height: 15px;padding: 5px 10px;letter-spacing:.4px;border-radius:0px; margin: -4px 10px 0px 0px;"><i class="fa fa-trash"></i> Decline Selected </button></div>',
						paging: true,
						pageSize: 10,
						sorting: true,
						defaultSorting: 'Id DESC',
						selecting: true, //Enable selecting
						multiselect: true, //Allow multiple selecting
						selectingCheckboxes: true, //Show checkboxes on first column
						selectOnRowClick: true, //Enable this to only select using checkboxes
						actions:
						{
							listAction: '/DigitalDesk/GetUploadApprovals?FileName=' + fileName,
						},
						fields: {
							Id: {
								key: true,
								create: false,
								edit: false,
								list: false
							},
							CompanyName: {
								title: 'CompanyName',
								width: '25%'
							},
							AcceptedTerms: {
								title: 'Terms',
								width: '10%'
							},
							EMTSignUp: {
								title: 'EMT',
								width: '10%'
							},
							SSI: {
								title: 'SSI',
								width: '10%'
							},
							AccountNumber: {
								title: 'Account-Number',
								width: '20%'
							},
							Currency: {
								title: 'Currency',
								width: '10%'
							},
							RepresentativeName: {
								title: 'RepresentativeName',
								width: '20%'
							},
							RepresentativePhonenumber: {
								title: 'Phone',
								width: '20%'
							},
							RepresentativeLimit: {
								title: 'Limit($)',
								width: '10%'
							},
							IsGM: {
								title: 'ISGM',
								width: '10%'
							},
							IsEMTUser: {
								title: 'EMTUSer',
								width: '10%'
							},
							DateOfContract: {
								title: 'DateOfContract',
								width: '10%'
							},
							Status: {	
								title: 'Status',
								width: '15%',
								display: function (data) {
									var approved = data.record.Status;
									if (approved == 1) {
										return '<center><p class="text-success"><i class="fa fa-check-circle"></i> Approved </p></center>';
									}
									else if (approved == 2) {
										return '<center><p class="text-danger"><i class="fa fa-times-circle"></i> Declined </p></center>';
									}
									else
									{
										return '<center><p class="text-warning"><i class="fa fa-check-circle"></i> Pending </p></center>';
									}
								}
							}
						},

						//Register to selectionChanged event to hanlde events
						selectionChanged: function () {
                            var $selectedRows = $('#UploadsTableContainer').jtable('selectedRows');
                            if ($selectedRows.length > 0) {
                                $selectedRows.each(function () {
                                    var record = $(this).data('record');
                                });
                            }
                        }
					});

					//Load list from server
					$('#UploadsTableContainer').jtable('load');

					//Decline selected items
					$('button#DeclineSelected').on('click', function (e) {
						e.preventDefault();
						var $selectedRows = $('#UploadsTableContainer').jtable('selectedRows');
						if ($selectedRows.length > 0) {
							Swal.fire({
								title: 'Are you sure?',
								text: "You won't be able to revert this!",
								icon: 'warning',
								showCancelButton: true,
								confirmButtonColor: '#28a745;',
								cancelButtonColor: '#d33',
								confirmButtonText: 'Yes, decline records',
								cancelButtonText: 'No, cancel',
							}).then((result) => {
								$selectedRows.each(function () {
		                            var ids = [];
									$selectedRows.each(function () {
										ids.push($(this).data('record').Id);
									});
					                $.ajax({
										url: "/DigitalDesk/DeclineSelected",
										type: 'POST',
										data: JSON.stringify(ids),
										contentType: 'application/json; charset=utf-8',
										dataType: "json",
										async: true,
										success: function (XmlHttpRequest) {
											if (XmlHttpRequest === 'success') {
												$('#UploadsTableContainer').jtable('load');
												Swal.fire(
													'Success!',
													'Your records has been successfully declined',
													'success'
												)
												$('#UploadsTableContainer').jtable('load');
											}
											else {
												Swal.fire({
													icon: 'error',
													text: XmlHttpRequest
												})
											}
										}
									})
								});
							})
						}
						else {
							Swal.fire('Please select record(s) to decline!')
						}
					});
				});
			</script>
		</div>
	</div>
</div>
