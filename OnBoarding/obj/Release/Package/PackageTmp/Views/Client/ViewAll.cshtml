@model IEnumerable<OnBoarding.ViewModels.ClientApplicationsViewModel>
@{
	ViewBag.Title = "ViewAll";
	Layout = "~/Views/Shared/_AdminNewLayout.cshtml";
}

    <section class="section">
        <h1 class="section-header">
            <div> My Applications </div>
        </h1>
        <div class="row">
            <div class="col-12 col-md-12 col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <h4>Application list</h4>
                    </div>
                    <div class="card-body">
                        <div class="item-data-retriving d_none">
                            <div class="float-right">
                                <button class="btn btn-danger select-another-item">
                                    <i class="fa fa ion-android-cancel"></i> Cancel Edit
                                </button>
                            </div>
                            <h6><i class="fa fa-adjust"></i> Edit Application Details </h6>
                            <hr />
                            <!--Load Up Data -->
                            <center id="RMDLoading_ID" class="d_none r_corners">
                                <h4 class="m_top_20 m_bottom_20"> Please wait... Fetching Application Details </h4>
                                <img src="~/Content/images/loading-bar.gif" class="img-thumbnail" alt="Loading" style="max-width:160px;">
                            </center>
                            <!--End Loading Up Data -->
                        </div>
                        <div class="item-data-retrived"></div>
                        <div id="ViewAllArea" class="table-responsive">
                            <table id="ApplicationsList" class="table table-bordered" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>Signatories</th>
                                        <th>Users</th>
                                        <th>Application Date</th>
                                        <th>Status</th>
                                        <th>Comments</th>
                                        <th>Approved</th>
                                        <th>Date Approved</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                    <tr>
                                        <td> @item.Signatories</td>
                                        <td> @item.DesignatedUsers</td>
                                        <td> @item.DateCreated</td>
                                        <td> @item.Status</td>
                                        <td> @item.OPSComments</td>
                                        <td> @(item.POAApproved ? "Approved" : "No")</td>
										<td>
											@if (item.Status == "Declined")
											{
												<center>@item.DateDeclined</center>
											}
											else
											{
												<center>@item.POADateApproved</center>
											}
										</td>
                                        <td>
                                            @if (item.Status == "Declined")
                                            {
                                                <!--<center>
                                                    <button data-id='@item.ApplicationID' type="submit" name="submit" class="btn btn-info btn-md btn-agent-id w_full">
                                                        <span class="glyphicon glyphicon-edit"></span> Edit
                                                    </button>
                                                </center>-->
												<center>
                                                    <i class="fa fa-shield-alt fa-2x" style="color:red;"></i>
                                                </center>

                                            }
                                            else
                                            {
                                                <center>
                                                    <i class="fa fa-shield-alt fa-2x" style="color:red;"></i>
                                                </center>
                                            }

                                        </td>
                                    </tr>
                                    }
                                </tbody>
                                <tfoot></tfoot>
                            </table>                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script type="text/javascript">
    jQuery().ready(function () {
        
    });

    $(document).ready(function () {
		//select-another-item
		$('.select-another-item').click(function (e) {
			e.preventDefault();
			$('.item-data-retrived').hide('fast');
			$('.item-data-retriving').hide('fast');
			$('#ViewAllArea').show('fast');
		});

		$('#ApplicationsList').DataTable({
			responsive: true
		});

		//Check if a user has applications
        $(".a-btn-3").click(function (e) {
            e.preventDefault();
            $.ajax({
                url: '@Url.Action("HaveApplications", "Client")',
                type: 'POST',
                async: true,
                success: function (XmlHttpRequest) {
                    if (XmlHttpRequest == 'success') {
                        //Take to application form
                        window.location.replace("/Client/Applications");
                    }
                    //Pop up with Error
                    else {
                        LoadUpModal();
                        $('#XmlHttpRequest').text(XmlHttpRequest);
                    }
                },
                cache: false,
                contentType: false,
                processData: false
            });
		});

		$('.btn-agent-id').click(function (e) {
			e.preventDefault();
			var ApplicationID = $(this).attr('data-id');
			$('#ViewAllArea').hide('fast');
			$('#RMDLoading_ID').show();
			$('.item-data-retriving').show('fast');

			$.ajax({
				type: "POST",
				url: "/Client/EditApplication",
				data: '{applicationId: "' + ApplicationID + '" }',
				contentType: "application/json; charset=utf-8",
				dataType: "html",

				success: function (data) {
					$('#RMDLoading_ID').hide();
					$('.item-data-retrived').show();
					$('.item-data-retrived').html(data);
				}
			});
		});
    });
    </script>
